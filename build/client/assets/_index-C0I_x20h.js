import{R as S,j as e,r as i,f as $,u as A}from"./index-keZNs5ok.js";import{g as I,b as R,e as L,f as O,h as V,i as B,d as G,c as H,a as J}from"./storage-CmIiShv6.js";import{L as j,F as K}from"./components-ooYZhqzC.js";import"./index-1bZHM5go.js";function Q({machine:t,userId:a,onEdit:c,onDelete:d}){const[o,h]=S.useState(null),[g,f]=S.useState(!0);return S.useEffect(()=>{(async()=>{try{const x=typeof t.id=="string"?parseInt(t.id,10):t.id,m=await I(a,x);if(m.length>0){const s=m.sort((u,y)=>new Date(y.date).getTime()-new Date(u.date).getTime())[0];h(s)}}catch(x){console.error(`Error fetching sessions for machine ${t.id}:`,x)}finally{f(!1)}})()},[a,t.id]),e.jsxs("div",{className:"relative bg-white dark:bg-zinc-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsxs(j,{to:`/machine/${t.id}`,className:"block",children:[e.jsx("div",{className:"h-32 flex items-center justify-center bg-gray-100 dark:bg-zinc-700",children:e.jsx("img",{src:`/images/machines/${t.image}`,alt:t.name,className:"h-full object-contain"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:t.name}),e.jsx("span",{className:"inline-block bg-gray-200 dark:bg-zinc-700 rounded-full px-2 py-1 text-xs font-semibold text-gray-700 dark:text-gray-300",children:t.category})]}),g?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Cargando..."}):o?e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"√öltima sesi√≥n:"}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("span",{className:"text-gray-800 dark:text-gray-200",children:[o.weight," kg √ó ",o.reps]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:new Date(o.date).toLocaleDateString()})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-block rounded-full px-2 py-1 text-xs font-semibold ${o.difficulty==="easy"?"bg-green-100 text-green-800":o.difficulty==="medium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:o.difficulty==="easy"?"F√°cil":o.difficulty==="medium"?"Medio":"Dif√≠cil"})})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No hay sesiones registradas"})]})]}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1 z-10",children:[c&&e.jsx("button",{type:"button",className:"p-1 bg-blue-500 hover:bg-blue-600 text-white rounded-full text-xs shadow focus:outline-none",title:"Editar m√°quina",onClick:n=>{n.stopPropagation(),n.preventDefault(),c(t)},children:"‚úé"}),d&&e.jsx("button",{type:"button",className:"p-1 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs shadow focus:outline-none",title:"Eliminar m√°quina",onClick:n=>{n.stopPropagation(),n.preventDefault(),d(t)},children:"üóë"})]})]})}function X({userId:t}){const[a,c]=i.useState([]),[d,o]=i.useState([]),[h,g]=i.useState(!0);return i.useEffect(()=>{(async()=>{try{const n=await R(t);n&&n.weight&&n.weightDates&&(c(n.weight),o(n.weightDates))}catch(n){console.error("Error fetching user weight data",n)}finally{g(!1)}})()},[t]),h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cargando datos..."})}):a.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No hay datos de peso disponibles"})}):a.length===1?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("p",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:[a[0]," kg"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(d[0]).toLocaleDateString()})]}):e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 flex items-end",children:a.map((f,n)=>{const x=new Date(d[n]),m=f/Math.max(...a)*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",style:{height:"100%"},children:[e.jsx("div",{className:"w-full bg-blue-500 rounded-t-sm mx-1",style:{height:`${m}%`}}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:[f," kg"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:x.toLocaleDateString()})]},n)})})})}function Y({userId:t}){const[a,c]=i.useState("weight"),[d,o]=i.useState([]),[h,g]=i.useState(!0),[f,n]=i.useState([]),[x,m]=i.useState(!1),[s,u]=i.useState("todas"),[y,P]=i.useState([]);i.useEffect(()=>{(async()=>{g(!0);try{if(a==="machines"){const b=(await L(t)).map(l=>({...l,id:Number(l.id)}));n(b);const W=[...new Set(b.map(l=>l.category))];P(W);const q=(await O(t)).map(l=>({...l,machineId:Number(l.machineId)})),T=await Promise.all(b.map(async l=>{const C=q.filter(N=>N.machineId===l.id);if(C.length===0)return{id:l.id,name:l.name,lastWeight:null,prevWeight:null,change:"new",category:l.category};const E=C.sort((N,U)=>new Date(U.date).getTime()-new Date(N.date).getTime()),v=E[0],z=new Date(v.date),F=new Date(z);F.setDate(z.getDate()-7);const p=E.find(N=>new Date(N.date)<F);let w="same";return p?v.weight>p.weight?w="up":v.weight<p.weight&&(w="down"):w="new",{id:l.id,name:l.name,lastWeight:v.weight,prevWeight:p?p.weight:null,change:w,category:l.category}}));o(T)}}catch(b){console.error("Error fetching machine progress",b)}finally{g(!1)}})()},[t,a]);const k=s==="todas"?d:d.filter(r=>r.category===s),M=[...k].sort((r,b)=>r.lastWeight===null?1:b.lastWeight===null?-1:0).slice(0,5),D=x?k:M;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsx("button",{className:`py-2 px-4 font-medium ${a==="weight"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,onClick:()=>c("weight"),children:"Tu Peso"}),e.jsx("button",{className:`py-2 px-4 font-medium ${a==="machines"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,onClick:()=>c("machines"),children:"Progreso por M√°quina"})]}),e.jsx("div",{className:"h-64",children:h?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cargando datos..."})}):a==="weight"?e.jsx(X,{userId:t}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{htmlFor:"cat-select",className:"text-sm text-gray-600 dark:text-gray-300",children:"Categor√≠a:"}),e.jsxs("select",{id:"cat-select",value:s,onChange:r=>u(r.target.value),className:"px-2 py-1 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-gray-800 dark:text-gray-100 text-sm",children:[e.jsx("option",{value:"todas",children:"Todas"}),y.map(r=>e.jsx("option",{value:r,children:r},r))]}),!x&&k.length>5&&e.jsx("button",{className:"ml-auto px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",onClick:()=>m(!0),children:"Ver todas"}),x&&e.jsx("button",{className:"ml-auto px-3 py-1 bg-gray-300 dark:bg-zinc-600 text-gray-800 dark:text-gray-100 rounded text-xs hover:bg-gray-400 dark:hover:bg-zinc-500",onClick:()=>m(!1),children:"Ver menos"})]}),e.jsx("div",{className:"overflow-y-auto h-full",children:D.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No hay datos de m√°quinas."}):e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:D.map(r=>e.jsxs("li",{className:"flex items-center justify-between py-3 px-2",children:[e.jsx(j,{to:`/machine/${r.id}`,className:"font-medium text-blue-700 dark:text-blue-300 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-400 rounded transition-colors",children:r.name}),e.jsxs("span",{className:"flex items-center gap-2",children:[r.lastWeight!==null&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[r.lastWeight," kg"]}),r.change==="up"&&e.jsx("span",{title:"Aumento",className:"text-green-600",children:"‚ñ≤"}),r.change==="down"&&e.jsx("span",{title:"Disminuci√≥n",className:"text-red-600",children:"‚ñº"}),r.change==="same"&&e.jsx("span",{title:"Sin cambio",className:"text-gray-400",children:"‚Üí"}),r.change==="new"&&e.jsx("span",{title:"Nuevo",className:"text-blue-400",children:"‚òÖ"}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:r.change==="new"?"nuevo":r.prevWeight!==null?`(antes: ${r.prevWeight} kg)`:""})]})]},r.id))})})]})})]})}function Z({user:t}){return e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-white text-2xl font-bold",style:{backgroundColor:t.color},children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:t.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Miembro desde ",new Date(t.createdAt).toLocaleDateString()]})]})]}),t.weight&&t.weight.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-2",children:"Peso Actual"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-50",children:[t.weight[t.weight.length-1]," kg"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(j,{to:"/profile/edit",className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",children:"Editar Perfil"}),e.jsx(K,{action:"/logout",method:"post",children:e.jsx("button",{type:"submit",className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors",children:"Cerrar Sesi√≥n"})})]})]})}function _(){return i.useEffect(()=>{V().then(t=>{console.log("Usuarios desde Firestore:",t)})},[]),e.jsx("div",{children:"Revisa la consola para ver los usuarios de Firestore."})}function re(){console.log("[Index] Renderizando componente principal",new Date().toISOString());const t=$(),a=t==null?void 0:t.currentUser;console.log("[Index] currentUser en render:",a),A();const[c,d]=i.useState([]),[o,h]=i.useState(!0),[g,f]=i.useState("todas"),n=Array.from(new Set(c.map(s=>s.category)));i.useEffect(()=>{console.log("[Index] useEffect ejecutado. currentUser:",a,new Date().toISOString()),a&&(document.documentElement.classList.add("loaded"),h(!0),L(a.id).then(s=>{console.log("[Firestore] M√°quinas obtenidas:",s);const u=s.map(y=>({id:y.id,name:y.name||"",image:y.image||"",category:y.category||""}));d(u),h(!1)}).catch(s=>{console.error("[Firestore] Error obteniendo m√°quinas:",s),h(!1)}))},[a]);const x=s=>{alert(`Editar m√°quina: ${s.name}`)},m=async s=>{if(a&&window.confirm(`¬øSeguro que deseas eliminar la m√°quina "${s.name}"?`))try{await B(G(H(J,"machines"),s.id.toString())),d(c.filter(u=>u.id!==s.id))}catch(u){console.error("Error deleting machine:",u)}};return e.jsxs(e.Fragment,{children:[e.jsx(_,{}),a?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(Z,{user:a})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Tu Progreso"}),e.jsx(Y,{userId:a.id})]}),o?e.jsx("div",{className:"text-center py-8",children:"Cargando m√°quinas..."}):c.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx(j,{to:"/machine/new",className:"inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 transform hover:scale-105",children:"Agregar primera m√°quina"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cat-select",className:"text-sm text-gray-600 dark:text-gray-300 mr-2",children:"Categor√≠a:"}),e.jsxs("select",{id:"cat-select",value:g,onChange:s=>f(s.target.value),className:"px-2 py-1 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-gray-800 dark:text-gray-100 text-sm",children:[e.jsx("option",{value:"todas",children:"Todas"}),n.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx(j,{to:"/machine/new",className:"inline-block bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200",children:"+ Agregar m√°quina"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:c.filter(s=>g==="todas"||s.category===g).map(s=>e.jsx(Q,{machine:s,userId:a.id,onEdit:x,onDelete:m},s.id))})]})]})]})}):e.jsx("div",{className:"flex h-screen items-center justify-center bg-gradient-to-b from-zinc-900 to-zinc-800",children:e.jsxs("div",{className:"text-center px-8 py-12 rounded-lg bg-zinc-800/50 backdrop-blur-sm max-w-md w-full mx-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Gym Progress"}),e.jsx("p",{className:"text-gray-300 mb-8",children:"Registra y monitorea tu progreso en el gimnasio de manera f√°cil y efectiva"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{to:"/profile/new",className:"block w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 transform hover:scale-105",children:"Crear Nuevo Perfil"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-600"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-400 bg-zinc-800/50",children:"o"})})]}),e.jsx(j,{to:"/profile/select",className:"block w-full bg-zinc-700 text-white px-6 py-3 rounded-lg hover:bg-zinc-600 transition-all duration-200 transform hover:scale-105",children:"Usar Perfil Existente"})]})]})})]})}export{re as default};
